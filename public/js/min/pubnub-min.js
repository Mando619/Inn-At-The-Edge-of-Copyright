let pubnub,channelName,channelGroup,publishTimetoken,msg,publisher,unixTimestamp,gmtDate,localeDateTime,affectedChannels,category,operation,action,uuid,thisUser;function createConnection(e){(pubnub=new PubNub({publishKey:"pub-c-3b1a90da-b8c6-4753-a965-7fd056636e55",subscribeKey:"sub-c-9fd7a810-f093-11ea-92d8-06a89e77181a",uuid:e})).addListener({message:e=>{displayMessage("[MESSAGE: received]",e),channelName=e.channel,channelGroup=e.subscription,publishTimetoken=e.timetoken,msg=e.message,publisher=e.publisher,unixTimestamp=e.timetoken/1e7,gmtDate=new Date(1e3*unixTimestamp),localeDateTime=gmtDate.toLocaleString()},status:e=>{affectedChannels=e.affectedChannels,category=e.category,operation=e.operation},presence:e=>{logAction(e),setTimeout(parseWhosOnline(),2e3),action=e.action,channelName=e.channel,uuid=e.uuid}})}function logAction(e){"join"==e.action?thisUser===e.uuid?logThis("You enter."):logThis(`${e.uuid} enters.`):"leave"==e.action&&(thisUser===e.uuid?logThis("You exit."):logThis(`${e.uuid} exits.`))}function publishDescription(e){pubnub.publish({channel:channel,message:{text:`${thisUser} ${e}`,messageIntent:"description"}},function(e,s){console.log("Publishing from submit button event"),e.error&&(console.log(e),console.log(s))})}function publishMessage(e){pubnub.publish({channel:channel,message:{text:`${thisUser}: ${e}`,messageIntent:"speech"}},function(e,s){console.log("Publishing from submit button event"),e.error&&(console.log(e),console.log(s))})}displayMessage=function(e,s){if(console.log("received message"),console.log(s),"speech"==s.message.messageIntent)$("#anchor").before(`<p class="displayed-message">${s.message.text}</p>`),updateScroll();else{let e=s.message.text;"y"===(e=(e=e.replace(thisUser,"you")).replace(thisUser.toLowerCase(),"you"))[0]?((e="Y"+e.slice(1)).split(" ")[1].endsWith("s")?(e=e.slice(0,e.split(" ")[1].length+3)+e.slice(e.split(" ")[1].length+4),$("#anchor").before(`<p class="displayed-message">${e}</p>`)):$("#anchor").before(`<p class="displayed-message">${e}</p>`),updateScroll()):($("#anchor").before(`<p class="displayed-message">${e}</p>`),updateScroll())}},getPlayerFromLoginInfo().then(e=>{createConnection(thisUser=e.characterName),setUserInventoryId().then(e=>{newLocation("start")})});